!function t(e,n,i){function r(s,u){if(!n[s]){if(!e[s]){var a="function"==typeof require&&require;if(!u&&a)return a(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return r(n?n:t)},c,c.exports,t,e,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(){window.MathBox.Shaders={"axis.position":"uniform vec4 axisStep;\nuniform vec4 axisPosition;\n\nvec4 getAxisPosition(vec2 uv) {\n  return axisStep * uv.x + axisPosition;\n}\n","cartesian.position":"uniform mat4 cartesianMatrix;\n\nvec4 getCartesianPosition(vec4 position) {\n  return cartesianMatrix * vec4(position.xyz, 1.0);\n}\n","line.color":"uniform vec3 lineColor;\nuniform float lineOpacity;\n\nvoid getLineColor() {\n	gl_FragColor = vec4(lineColor, lineOpacity);\n}\n","line.position":"uniform float lineWidth;\nattribute vec2 line;\n\n// External\nvec3 getPosition(vec2 xy);\n\nvoid getLineGeometry(vec2 xy, float edge, inout vec3 left, inout vec3 center, inout vec3 right) {\n  vec2 delta = vec2(1.0, 0.0);\n\n  center =                 getPosition(xy);\n  left   = (edge > -0.5) ? getPosition(xy - delta) : center;\n  right  = (edge < 0.5)  ? getPosition(xy + delta) : center;\n}\n\nvec3 getLineJoin(float edge, vec3 left, vec3 center, vec3 right) {\n  vec3 bitangent;\n  vec3 normal = center;\n\n  vec3 legLeft = center - left;\n  vec3 legRight = right - center;\n\n  if (edge > 0.5) {\n    bitangent = normalize(cross(normal, legLeft));\n  }\n  else if (edge < -0.5) {\n    bitangent = normalize(cross(normal, legRight));\n  }\n  else {\n    vec3 joinLeft = normalize(cross(normal, legLeft));\n    vec3 joinRight = normalize(cross(normal, legRight));\n    float dotLR = dot(joinLeft, joinRight);\n    float scale = min(8.0, tan(acos(dotLR * .999) * .5) * .5);\n    bitangent = normalize(joinLeft + joinRight) * sqrt(1.0 + scale * scale);\n  }\n  \n  return bitangent;\n}\n\nvec3 getLinePosition() {\n  vec3 left, center, right, join;\n\n  float edge = line.x;\n  float offset = line.y;\n\n  getLineGeometry(position.xy, edge, left, center, right);\n  join = getLineJoin(edge, left, center, right);\n  return center + join * offset * lineWidth;\n}\n","project.position":"void setPosition(vec3 position) {\n	gl_Position   = projectionMatrix * vec4(position, 1.0);\n}\n","view.position":"vec3 getViewPosition(vec4 position) {\n  return (modelViewMatrix * vec4(position.xyz, 1.0)).xyz;\n}"}},{}],2:[function(t,e){var n,i,r,o,s,u;i=t("./model"),u=t("./stage"),o=t("./render"),s=t("./shaders"),r=t("./primitives"),n=function(){function t(t,e,n,a){null==a&&(a=[]),this.shaders=new s.Factory(s.Snippets),this.scene=new o.Scene(e),this.renderables=new o.Factory(t,o.Classes,this.shaders),this.attributes=new i.Attributes(r.Traits,r.Types),this.primitives=new r.Factory(r.Classes,this.attributes,this.renderables,this.shaders),this.model=new i.Model(this.primitives.make("root")),this.controller=new u.Controller(this.model,this.scene,this.primitives),this.animator=new u.Animator(this.model),this.director=new u.Director(this.controller,this.animator,a),this.api=new u.API(this.controller,this.animator,this.director)}return t.prototype.init=function(){return this.scene.inject()},t.prototype.destroy=function(){return this.scene.unject()},t.prototype.update=function(){return this.animator.update(),this.attributes.digest()},t}(),e.exports=n},{"./model":6,"./primitives":10,"./render":30,"./shaders":37,"./stage":42}],3:[function(t,e,n){var i,r;r=function(t){var e;return null==t&&(t={}),null==t.plugins&&(t.plugins=["core","mathbox"]),e=THREE.Bootstrap(t),e.mathbox},window.MathBox=n,window.mathBox=n.mathBox=r,n.version="2",t("../build/shaders"),i=t("./context"),THREE.Bootstrap.registerPlugin("mathbox",{defaults:{init:!0},listen:["ready","update"],install:function(t){var e;return e=!1,t.MathBox={init:function(n){return function(r){var o,s,u;if(!e)return e=!0,s=(null!=r?r.scene:void 0)||n.options.scene||t.scene,o=(null!=r?r.camera:void 0)||n.options.camera||t.camera,u=(null!=r?r.script:void 0)||n.options.script,n.context=new i(t.renderer.context,s,o,u),n.context.api.three=t,t.mathbox=n.context.api,n.context.init(),window.model=n.context.model,window.root=n.context.model.root}}(this),destroy:function(n){return function(){return e?(e=!1,n.context.destroy(),delete t.mathbox,delete n.context.api.three,delete n.context):void 0}}(this),object:function(){var t;return null!=(t=this.context)?t.scene.getRoot():void 0}}},uninstall:function(t){return t.MathBox.destroy(),delete t.MathBox},ready:function(t,e){return this.options.init?e.MathBox.init():void 0},update:function(){var t;return null!=(t=this.context)?t.update():void 0}})},{"../build/shaders":1,"./context":2}],4:[function(t,e){var n,i;n=function(){function t(t,e){this.traits=t,this.types=e,this.pending=[]}return t.prototype.make=function(t){return{type:"function"==typeof t.uniform?t.uniform():void 0,value:t.make()}},t.prototype.getSpec=function(t){return this.traits[t]},t.prototype.queue=function(t){return this.pending.push(t)},t.prototype.apply=function(t,e){return null==e&&(e=[]),new i(t,e,this)},t.prototype.digest=function(){var t,e,n,i,r,o;for(n=10;this.pending.length>0&&--n>0;)for(o=[this.pending,[]],e=o[0],this.pending=o[1],i=0,r=e.length;r>i;i++)(t=e[i])();if(0===n)throw console.error("While digesting: ",object),Error("Infinite loop in Data::digest")},t}(),i=function(){function t(t,e,n){var i,r,o,s,u,a,c,l,h,p,f,d,v,m,y,g,_,x,b;for(null==e&&(e=[]),a=function(t){return function(e){var n;return null!=(n=t[e])?n.value:void 0}}(this),f=function(t){return function(e,n,r){var o;return o=m(e,n,t[e].value),null!=o&&(t[e].value=o),r?void 0:i(e)}}(this),t.get=function(t){return function(e){var n,i;if(null!=e)return a(e);n={};for(e in t)i=t[e],n[e]=i.value;return n}}(this),t.set=function(t,e,n){var i;if(null!=t&&null!=e)null!=y[t]&&f(t,e,n);else{i=t;for(t in i)e=i[t],null!=y[t]&&f(t,e,n)}},l={},y={},m=function(t,e,n){return y[t](e,n)},t.validate=function(t,e){var n,i,r;return n=l[t],null!=n&&(r=n()),i=m(t,e,r),null!=i?i:r},s=!1,r={},i=function(t){return function(e){return s||(s=!0,n.queue(o)),r[e]=t[e].value}}(this),u={type:"change",changed:null},o=function(){return u.changed=r,r={},s=!1,t.trigger(u)},g={},_=0,x=e.length;x>_;_++){v=e[_],b=v.split(":"),v=b[0],h=b[1],null==h&&(h=v),d=n.getSpec(v);for(c in d)p=d[c],c=[h,c].join("."),this[c]={type:"function"==typeof p.uniform?p.uniform():void 0,value:p.make()},l[c]=p.make,y[c]=p.validate}}return t}(),e.exports=n},{}],5:[function(t,e){var n,i,r={}.hasOwnProperty,o=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=t("./node"),n=function(t){function e(t,n,i,r){e.__super__.constructor.call(this,t,n,i,r),this.children=[]}return o(e,t),e.prototype.add=function(t){return this.children.push(t),t._added(this)},e.prototype.remove=function(t){var e;return this.children=function(){var n,i,r,o;for(r=this.children,o=[],n=0,i=r.length;i>n;n++)e=r[n],e!==t&&o.push(e);return o}.call(this),t._removed(this)},e}(i),e.exports=n},{"./node":8}],6:[function(t,e,n){n.Attributes=t("./attributes"),n.Group=t("./group"),n.Model=t("./model"),n.Node=t("./node")},{"./attributes":4,"./group":5,"./model":7,"./node":8}],7:[function(t,e){var n;n=function(){function t(t){this.root=t,this.root.model=this,this.root.root=this.root}return t.prototype.getRoot=function(){return this.root},t}(),THREE.Binder.apply(n.prototype),e.exports=n},{}],8:[function(t,e){var n;n=function(){function t(t,e,n,i){this.type=e,this.traits=null!=n?n:[],this.attributes=i.apply(this,this.traits),this.parent=null,this.root=null,this.set(t,null,!0)}return t.prototype._added=function(t){var e;return this.parent=t,this.root=t.root,e={type:"added",object:this,parent:this.parent},this.trigger(e),this.root!==this?this.root.model.trigger(e):void 0},t.prototype._removed=function(){var t;return this.root=this.parent=null,t={type:"removed",object:this},this.trigger(t),this.root!==this?this.root.model.trigger(t):void 0},t}(),THREE.Binder.apply(n.prototype),e.exports=n},{}],9:[function(t,e){var n;n=function(){function t(t,e,n,i){this.classes=t,this.attributes=e,this.renderables=n,this.shaders=i}return t.prototype.getTypes=function(){return Object.keys(this.classes)},t.prototype.make=function(t,e){var n,i,r,o;return i=this.classes[t],o=i.model,r=new o(e,t,i.traits,this.attributes),n=new i(r,this.attributes,this.renderables,this.shaders),r},t}(),e.exports=n},{}],10:[function(t,e,n){var i;i=t("./types"),n.Factory=t("./factory"),n.Primitive=t("./primitive"),n.Types=i.Types,n.Traits=i.Traits,n.Classes=i.Classes},{"./factory":9,"./primitive":11,"./types":16}],11:[function(t,e){var n,i;n=t("../model"),i=function(){function t(t,e,n,i){this.model=t,this._attributes=e,this._factory=n,this._shaders=i,this.model.primitive=this,this.model.on("change",function(t){return function(e){return t.root?t._change(e.changed):void 0}}(this)),this.model.on("added",function(t){return function(){return t._added()}}(this)),this.model.on("removed",function(t){return function(){return t._removed()}}(this)),this.inherited=[]}return t.Node=n.Node,t.Group=n.Group,t.model=t.Node,t.traits=[],t.prototype.rebuild=function(){return this.root?(this._unmake(),this._make(),this._change({},!0)):void 0},t.prototype._make=function(){},t.prototype._unmake=function(){},t.prototype._added=function(){return this.root=this.model.root,this.parent=this.model.parent.primitive,this._make(),this._change({},!0)},t.prototype._removed=function(){return this.root=null},t.prototype._render=function(t){return this.trigger({type:"render",renderable:t})},t.prototype._unrender=function(t){return this.trigger({type:"unrender",renderable:t})},t.prototype._transform=function(t){var e;return null!=(e=this.parent)?e._transform(t):void 0},t.prototype._change=function(){},t.prototype._listen=function(t,e){var n,i;if(t!==this)return n=function(t){return function(n){var i;return i=n.changed,t.root&&null!=i[e]?t._change(i):void 0}}(this),t.model.on("change",n),i=[t,n],this.inherited.push(i)},t.prototype._unlisten=function(t){var e,n;return n=t[0],e=t[1],n.model.off("change",e)},t.prototype._inherit=function(t,e){return null==e&&(e=this),null!=this.model.get(t)?(e._listen(this,t),this.model):null!=this.parent?this.parent._inherit(t,e):null},t.prototype._unherit=function(){var t,e,n,i;for(i=this.inherited,e=0,n=i.length;n>e;e++)t=i[e],this._unlisten(t);return this.inherited=[]},t}(),THREE.Binder.apply(i.prototype),e.exports=i},{"../model":6}],12:[function(t,e){var n,i,r={}.hasOwnProperty,o=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=t("../primitive"),n=function(t){function e(t,n,i,r){e.__super__.constructor.call(this,t,n,i,r),this.axisPosition=this.axisStep=this.resolution=this.line=null}return o(e,t),e.traits=["object","style","line","axis"],e.prototype._make=function(){var t,e,n,i,r,o;return this.inherit=this._inherit("view.range"),o=this._attributes.types,i={axisPosition:this._attributes.make(o.vec4()),axisStep:this._attributes.make(o.vec4())},this.axisPosition=i.axisPosition.value,this.axisStep=i.axisStep.value,n=this._shaders.shader(),n.call("axis.position",i),this._transform(n),t=this.model.get("axis.detail"),r=t+1,this.resolution=1/t,e={lineWidth:this.model.attributes["line.width"],lineColor:this.model.attributes["style.color"],lineOpacity:this.model.attributes["style.opacity"]},this.line=this._factory.make("line",{uniforms:e,samples:r,position:n}),this._render(this.line)},e.prototype._unmake=function(){return this._unrender(this.line),this.line.dispose(),this.line=null,this.position=null,this._unherit()},e.prototype._change=function(t,e){var n,i,r,o,s,u,a,c,l,h;return null!=t["axis.detail"]&&this.rebuild(),null!=t["view.range"]||null!=t["axis.range"]||null!=t["axis.dimension"]||null!=t["axis.inherit"]||e?(i=this.model.get("axis.inherit"),n=this.model.get("axis.dimension"),i&&this.inherit?(u=this.inherit.get("view.range"),s=u[n-1]):s=this.model.get("axis.range"),o=s.x,r=s.y,c=1===n?1:0,l=2===n?1:0,h=3===n?1:0,a=4===n?1:0,this.axisPosition.set(c,l,h,a).multiplyScalar(o),this.axisStep.set(c,l,h,a).multiplyScalar((r-o)*this.resolution)):void 0},e}(i),e.exports=n},{"../primitive":11}],13:[function(t,e){var n,i,r={}.hasOwnProperty,o=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=t("./view"),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype._make=function(){var t;return t=this._attributes.types,this.uniforms={cartesianMatrix:this._attributes.make(t.mat4())},this.cartesianMatrix=this.uniforms.cartesianMatrix.value,this.rotationMatrix=new THREE.Matrix4},e.prototype._unmake=function(){return delete this.cartesianMatrix,delete this.rotationMatrix},e.prototype._change=function(){var t,e,n,i,r,o,s,u,a,c,l,h,p;return i=this.model.get("object.position"),s=this.model.get("object.scale"),r=this.model.get("object.rotation"),o=this.model.get("view.range"),l=o[0].x,h=o[1].x,p=o[2].x,t=o[0].y-l||1,e=o[1].y-h||1,n=o[2].y-p||1,u=s.x,a=s.y,c=s.z,this.cartesianMatrix.set(2*u/t,0,0,-(2*l+t)*u/t,0,2*a/e,0,-(2*h+e)*a/e,0,0,2*c/n,-(2*p+n)*c/n,0,0,0,1),this.rotationMatrix.makeRotationFromQuaternion(r),this.cartesianMatrix.multiplyMatrices(this.rotationMatrix,this.cartesianMatrix)},e.prototype.to=function(t){return t.applyMatrix4(this.cartesianMatrix)},e.prototype._transform=function(t){var e;return t.call("cartesian.position",this.uniforms),null!=(e=this.parent)?e._transform(t):void 0},e}(i),e.exports=n},{"./view":20}],14:[function(t,e){var n,i,r,o,s={}.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=t("../primitive"),r=t("../../util").Ticks,o=t("./types"),n=function(t){function e(t,n,i,r){e.__super__.constructor.call(this,t,n,i,r),this.widths=[],this.lines=null,this.buffers=null,this.grids=[]}return u(e,t),e.traits=["line","object","grid","axis:axis[0]","axis:axis[1]"],e.prototype._make=function(){var t,e,n;return this.inherit=this._inherit("view"),n={lineWidth:this.attributes["line.width"],lineColor:this.attributes["style.color"],lineOpacity:this.attributes["style.opacity"]},e=function(t){var e,i,r,o,s,u,a,c;u=this._attributes.types,i={gridRange:this._attributes.make(u.vec2(-1,1)),gridAxis:this._attributes.make(u.vec3(0,2,0)),gridOffset:this._attributes.make(u.vec2(0,-1,0))};for(r in n)a=n[r],i[r]=a;return s=this.get(t+"ticks"),c=2*s,e=this._factory.make("databuffer",{samples:c,channels:1}),o=this._factory.make("line",{uniforms:n,buffer:e}),this.widths.push(c),this.buffers.push(e),this.lines.push(o),this.grids.push(i),this._render(o)},t=this.get("grid.axes"),e("axis[0].",t[0])},e.prototype._unmake=function(){var t,e,n,i,r,o,s,u;for(s=this.buffers,n=0,r=s.length;r>n;n++)t=s[n],t.dispose();for(u=this.lines,i=0,o=u.length;o>i;i++)e=u[i],this._unrender(e),e.dispose();return this.widths=[],this.lines=null,this.buffers=null},e.prototype._change=function(t){var e,n;return null!=t["axis1.ticks"]||null!=t["axis2.ticks"]?this.rebuild():(n=function(t,e,n){var i,o,s,u,a,c,l,h,p;return o=this.get(t+"inherit"),o&&this.inherit?(c=this.inherit.get("view.range"),a=c[e]):a=this.get(t+"range"),h=this.get(t+"ticks"),p=this.get(t+"unit"),i=this.get(t+"base"),l=this.get(t+"scale"),u=a.x,s=a.y,h=r.make(l,u,s,h,p,i),n.copy(h)},e=this.get("grid.axes"),n("axis[0].",e[0],this.buffer[0],this.grid[0]))},e}(i),e.exports=n},{"../../util":43,"../primitive":11,"./types":19}],15:[function(t,e){var n,i,r={}.hasOwnProperty,o=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=t("../primitive"),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.model=i.Group,e}(i),e.exports=n},{"../primitive":11}],16:[function(t,e,n){var i,r,o,s;o=t("../../model"),s=o.Node,r=o.Group,i={axis:t("./axis"),grid:t("./grid"),cartesian:t("./cartesian"),group:t("./group"),root:t("./root"),view:t("./view")},n.Classes=i,n.Types=t("./types"),n.Traits=t("./traits")},{"../../model":6,"./axis":12,"./cartesian":13,"./grid":14,"./group":15,"./root":17,"./traits":18,"./types":19,"./view":20}],17:[function(t,e){var n,i,r={}.hasOwnProperty,o=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=t("./group"),i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.traits=["object"],e.prototype._transform=function(t){return t.call("view.position")},e}(n),e.exports=i},{"./group":15}],18:[function(t,e){var n,i;i=t("./types"),n={object:{position:i.vec4(),rotation:i.quat(),scale:i.vec4(1,1,1,1),visible:i.bool(!0)},style:{opacity:i.number(1),color:i.color()},data:{position:i.object(),color:i.object()},line:{width:i.number(.01)},view:{dimensions:i.number(3),range:i.array(i.vec2(-1,1),4)},axis:{inherit:i.bool(!0),range:i.vec2(-1,1),dimension:i.number(1),detail:i.number(1)},ticks:{divide:i.number(10),unit:i.number(1),base:i.number(10),scale:i.scale(),size:i.number(5)}},e.exports=n},{"./types":19}],19:[function(t,e){var n;n={array:function(t,e){return{uniform:function(){return t.uniform()+"v"},make:function(){var n,i,r;for(r=[],n=i=0;e>=0?e>i:i>e;n=e>=0?++i:--i)r.push(t.make());return r},validate:function(n,i){var r,o,s,u,a,c;if(null!=n.constructor&&n.constructor===Array)for(i.length=e?e:n.length,r=s=0,a=i.length;a>=0?a>s:s>a;r=a>=0?++s:--s)o=t.validate(n[r],i[r]),null!=o&&(i[r]=o);else for(i.length=e,r=u=0,c=i.length;c>=0?c>=u:u>=c;r=c>=0?++u:--u)i[r]=t.value}}},bool:function(t){return{uniform:function(){return"f"},make:function(){return!!t},validate:function(t){return!!t}}},number:function(t){return null==t&&(t=0),{uniform:function(){return"f"},make:function(){return+t},validate:function(t){return+t||0}}},string:function(t){return null==t&&(t=""),{make:function(){return""+t},validate:function(t){return""+t}}},scale:function(t){return new n.string(t)},object:function(){return{make:function(){return{}},validate:function(t){return t}}},vec2:function(t,e){var n;return null==t&&(t=0),null==e&&(e=0),n=[t,e],{uniform:function(){return"v2"},make:function(){return new THREE.Vector2(t,e)},validate:function(i,r){i instanceof THREE.Vector2?r.copy(i):(null!=i?i.constructor:void 0)===Array?(i=i.concat(n.slice(i.length)),r.set.apply(r,i)):r.set(t,e)}}},vec3:function(t,e,n){var i;return null==t&&(t=0),null==e&&(e=0),null==n&&(n=0),i=[t,e,n],{uniform:function(){return"v3"},make:function(){return new THREE.Vector3(t,e,n)},validate:function(r,o){r instanceof THREE.Vector3?o.copy(r):(null!=r?r.constructor:void 0)===Array?(r=r.concat(i.slice(r.length)),o.set.apply(o,r)):o.set(t,e,n)}}},vec4:function(t,e,n,i){var r;return null==t&&(t=0),null==e&&(e=0),null==n&&(n=0),null==i&&(i=0),r=[t,e,n,i],{uniform:function(){return"v4"},make:function(){return new THREE.Vector4(t,e,n,i)},validate:function(o,s){o instanceof THREE.Vector4?s.copy(o):(null!=o?o.constructor:void 0)===Array?(o=o.concat(r.slice(o.length)),s.set.apply(s,o)):s.set(t,e,n,i)}}},mat4:function(t,e,n,i,r,o,s,u,a,c,l,h,p,f,d,v){var m;return null==t&&(t=1),null==e&&(e=0),null==n&&(n=0),null==i&&(i=0),null==r&&(r=0),null==o&&(o=1),null==s&&(s=0),null==u&&(u=0),null==a&&(a=0),null==c&&(c=0),null==l&&(l=1),null==h&&(h=0),null==p&&(p=0),null==f&&(f=0),null==d&&(d=0),null==v&&(v=1),m=[t,e,n,i,r,o,s,u,a,c,l,h,p,f,d,v],{uniform:function(){return"m4"},make:function(){return new THREE.Matrix4(t,e,n,i,r,o,s,u,a,c,l,h,p,f,d,v)},validate:function(y,g){y instanceof THREE.Matrix4?g.copy(y):(null!=y?y.constructor:void 0)===Array?(y=y.concat(m.slice(y.length)),g.set.apply(g,y)):g.set(t,e,n,i,r,o,s,u,a,c,l,h,p,f,d,v)}}},quat:function(t,e,i,r){var o;return null==t&&(t=0),null==e&&(e=0),null==i&&(i=0),null==r&&(r=1),o=n.vec4(t,e,i,r),{uniform:function(){return"v4"},make:function(){return new THREE.Quaternion},validate:function(t,e){var n;return t instanceof THREE.Quaternion?e.copy(t):n=o.validate(t,e),(null!=n?n:e).normalize(),n}}},color:function(t,e,i){var r;return null==t&&(t=.5),null==e&&(e=.5),null==i&&(i=.5),r=n.vec3(t,e,i),{uniform:function(){return"v3"},make:function(){return new THREE.Vector3(t,e,i)},validate:function(t,e){var n;return t===""+t?(n=t,t=(new THREE.Color).setStyle(n)):t===+t&&(t=new THREE.Color(t)),t instanceof THREE.Color?void e.set(t.r,t.g,t.b):r.validate(t,e)}}}},e.exports=n},{}],20:[function(t,e){var n,i,r,o={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var i in e)o.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=t("./group"),i=t("../../util").Range,r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.traits=["object","view"],e.prototype.axis=function(t){var e;return e=this.get("view.range")[t-1]},e.prototype.to=function(){},e}(n),e.exports=r},{"../../util":43,"./group":15}],21:[function(t,e){var n,i,r={}.hasOwnProperty,o=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=t("../renderable"),n=function(t){function e(t,n,i){null==this.samples&&(this.samples=i.samples||1),null==this.channels&&(this.channels=i.channels||4),e.__super__.constructor.call(this,t,n),this.build()}var n;return o(e,t),n=65535,e.prototype.build=function(){return this.uniforms={dataPointer:{type:"v2",value:new THREE.Vector2}}},e.prototype.dispose=function(){return this.data=null,this.texture.dispose(),e.__super__.dispose.apply(this,arguments)},e.prototype.update=function(){return this.iterate(),this.write()},e.prototype.copy=function(t){var e,n,i;for(n=Math.min(t.length,this.samples*this.channels),e=i=0;n>=0?n>i:i>n;e=n>=0?++i:--i)this.data[e]=t[e];return this.write()},e.prototype.write=function(){},e.prototype.iterate=function(){},e.prototype.generate=function(){var t,e,n,i;switch(n=this.samples,t=this.data,e=!1,i=0,this.channels){case 1:return function(r){return e||(t[i++]=r||0),!(e=i>=n)};case 2:return function(r,o){return e||(t[i++]=r||0,t[i++]=o||0),!(e=i>=n)};case 3:return function(r,o,s){return e||(t[i++]=r||0,t[i++]=o||0,t[i++]=s||0),!(e=i>=n)};case 4:return function(r,o,s,u){return e||(t[i++]=r||0,t[i++]=o||0,t[i++]=s||0,t[i++]=u||0),!(e=i>=n)}}},e}(i),e.exports=n},{"../renderable":33}],22:[function(t,e,n){n.Texture=t("./texture"),n.Buffer=t("./buffer"),n.LineBuffer=t("./linebuffer"),n.SurfaceBuffer=t("./surfacebuffer")},{"./buffer":21,"./linebuffer":23,"./surfacebuffer":24,"./texture":25}],23:[function(t,e){var n,i,r,o={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var i in e)o.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=t("./buffer"),r=t("./texture"),i=function(t){function e(t,n,i){this.callback=i.callback||function(){},this.width=i.width||1,this.history=i.history||1,this.samples=this.width,e.__super__.constructor.call(this,t,n,i)}return s(e,t),e.prototype.build=function(){return e.__super__.build.apply(this,arguments),this.data=new Float32Array(this.samples*this.channels),this.texture=new r(this.gl,this.samples,this.history,this.channels),this.index=0,this.dataPointer=this.uniforms.dataPointer.value,this._adopt(this.texture.uniforms)},e.prototype.iterate=function(){var t,e,i;for(t=this.callback,i=this.generate(),e=0;t(e++,i)&&e<n.iterationLimit;);},e.prototype.write=function(){return this.texture.write(this.data,0,this.index,this.samples,1),this.dataPointer.set(.5,this.index+.5),this.index=(this.index+1)%this.history},e}(n),e.exports=i},{"./buffer":21,"./texture":25}],24:[function(t,e){var n,i,r,o={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var i in e)o.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=t("./buffer"),r=t("./texture"),i=function(t){function e(t,n,i){this.callback=i.callback||function(){},this.width=i.width||1,this.height=i.height||1,this.history=i.history||1,this.channels=i.channels||4,this.samples=this.width*this.height,e.__super__.constructor.call(this,t,n,i)}return s(e,t),e.prototype.build=function(){return e.__super__.build.apply(this,arguments),this.data=new Float32Array(this.samples*this.channels),this.texture=new r(this.gl,this.width,this.height*this.history,this.channels),this.index=0,this.dataPointer=this.uniforms.dataPointer.value,this._adopt(this.texture.uniforms)},e.prototype.iterate=function(){var t,e,i,r,o,s,u;for(t=this.callback,s=this.generate(),o=this.width,e=i=r=0;++r<n.iterationLimit&&(u=t(e,i,s));)++e===o&&(e=0,i++)},e.prototype.write=function(){return this.texture.write(this.data,0,this.index,this.width,this.height),this.dataPointer.set(.5,this.index+.5),this.index=(this.index+1)%this.history},e}(n),e.exports=i},{"./buffer":21,"./texture":25}],25:[function(t,e){var n;n=function(){function t(t,e,n,i){this.gl=t,this.width=e,this.height=n,this.channels=i,this.n=this.width*this.height*this.channels,this.build()}return t.prototype.build=function(){var t;return t=this.gl,this.texture=t.createTexture(),this.type=[null,t.LUMINANCE,t.LUMINANCE_ALPHA,t.RGB,t.RGBA][this.channels],t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),this.data=new Float32Array(this.n),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,this.type,t.FLOAT,this.data),this.textureObject=new THREE.Texture(new Image,new THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter),this.textureObject.__webglInit=!0,this.textureObject.__webglTexture=texture,this.uniforms={dataResolution:{type:"v2",value:new THREE.Vector2(1/this.width,1/this.height)},dataTexture:{type:"t",value:this.textureObject}}},t.prototype.write=function(t,e,n,i,r){var o;return o=this.gl,o.bindTexture(o.TEXTURE_2D,this.texture),o.pixelStorei(o.UNPACK_ALIGNMENT,1),o.texSubImage2D(o.TEXTURE_2D,0,e,n,i,r,this.type,o.FLOAT,t)},t.prototype.dispose=function(){throw"Texture::dispose not yet implemented"},t}(),e.exports=n},{}],26:[function(t,e){var n;n=function(){function t(t,e,n){this.gl=t,this.classes=e,this.shaders=n}return t.prototype.getTypes=function(){return Object.keys(this.classes)},t.prototype.make=function(t,e,n){return new this.classes[t](this.gl,this.shaders,e,n)},t}(),e.exports=n},{}],27:[function(t,e){var n,i={}.hasOwnProperty,r=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=function(t){function e(){THREE.BufferGeometry.call(this)}return r(e,t),e.prototype._emitter=function(t){var e,n,i,r,o,s,u,a;return n=this.attributes[t],i=n.itemSize,e=n.array,o=0,s=function(t){return e[o++]=t},a=function(t,n){return e[o++]=t,e[o++]=n},u=function(t,n,i){return e[o++]=t,e[o++]=n,e[o++]=i},r=function(t,n,i,r){return e[o++]=t,e[o++]=n,e[o++]=i,e[o++]=r},[null,s,a,u,r][i]},e}(THREE.BufferGeometry),e.exports=n},{}],28:[function(t,e,n){n.Geometry=t("./geometry"),n.LineGeometry=t("./linegeometry")},{"./geometry":27,"./linegeometry":29}],29:[function(t,e){var n,i,r={}.hasOwnProperty,o=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=t("./geometry"),i=function(t){function e(t){var e,n,i,r,o,s,u,a,c,l,h,p,f,d,v,m,y,g,_,x,b,w,E;for(THREE.BufferGeometry.call(this),this.samples=p=+t.samples||2,this.strips=d=+t.strips||1,this.ribbons=h=+t.ribbons||1,this.segments=f=p-1,a=p*d*h*2,l=f*d*h,v=2*l,this.addAttribute("index",Uint16Array,3*v,1),this.addAttribute("position",Float32Array,a,3),this.addAttribute("line",Float32Array,a,2),r=this._emitter("index"),c=this._emitter("position"),u=this._emitter("line"),e=0,i=g=0;h>=0?h>g:g>h;i=h>=0?++g:--g)for(o=_=0;d>=0?d>_:_>d;o=d>=0?++_:--_){for(s=x=0;p>=0?p>=x:x>=p;s=p>=0?++x:--x)r(e),r(e+1),r(e+2),r(e+2),r(e+1),r(e+3),e+=2;e+=2}for(i=b=0;h>=0?h>b:b>h;i=h>=0?++b:--b){for(y=0,o=w=0;d>=0?d>w:w>d;o=d>=0?++w:--w)for(m=0,s=E=0;p>=0?p>E:E>p;s=p>=0?++E:--E)n=0===s?-1:s===f?1:0,c(m,y,0),c(m,y,0),u(n,1),u(n,-1),m++;y++}this.clip(0,l)}return o(e,t),e.prototype.shaderAttributes=function(){return{line:{type:"v2",value:null}}},e.prototype.clip=function(t,e){return this.offsets=[{start:6*t,count:6*(e-t)}]},e}(n),e.exports=i},{"./geometry":27}],30:[function(t,e,n){var i;i=t("./types"),n.Scene=t("./scene"),n.Factory=t("./factory"),n.Renderable=t("./scene"),n.Classes=i.Classes},{"./factory":26,"./scene":34,"./types":35}],31:[function(t,e,n){n.Line=t("./line")},{"./line":32}],32:[function(t,e){var n,i,r,o,s,u={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var i in e)u.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};s="\n/*\n//Data sampler\n\nuniform sampler2D dataTexture;\nuniform vec2 dataResolution;\nuniform vec2 dataPointer;\n\nvec2 mapUV(vec2 xy) {\n  return vec2(xy.y, 0);\n}\n\nvec4 sampleData(vec2 xy) {\n  vec2 uv = fract((mapUV(xy) + dataPointer) * dataResolution);\n  vec4 sample = texture2D(dataTexture, uv);\n  return transformData(uv, sample);\n}\n\n*/\n\n/*\n// Grid\nuniform vec2 gridRange;\nuniform vec4 gridAxis;\nuniform vec4 gridOffset;\n\nvec4 transformData(vec2 uv, vec4 data) {\n  return vec4(data.r, 0, 0, 0) + gridAxis * uv.x + gridOffset;\n}\n*/\n\n/*\n// Axis\n*/\nuniform vec4 axisStep;\nuniform vec4 axisPosition;\n\nvec4 sampleData(vec2 uv) {\n  return axisStep * uv.x + axisPosition;\n}\n\n/*\n// Viewport\n*/\nuniform mat4 cartesianMatrix;\n\nvec4 cartesian(vec4 position) {\n//  return cartesianMatrix * vec4(position.xyz, 1.0);\n  return vec4(position.xyz, 1.0);\n}\n\n/*\nvec4 cartesian4(vec4 position) {\n  return cartesian4Matrix * position;\n}\n*/\n\n/*\n// Pipeline\n*/\nvec3 worldToView(vec4 position) {\n  return (modelViewMatrix * vec4(position.xyz, 1.0)).xyz;\n}\n\nvec3 transformToView(vec4 position) {\n  return worldToView(cartesian(position));\n}\n\nvec3 samplePosition(vec2 xy) {\n  vec4 sample = sampleData(xy);\n  return transformToView(sample);\n}\n\n\n/*\n//Line\n*/\n\nvoid getLineGeometry(vec2 xy, float edge, inout vec3 left, inout vec3 center, inout vec3 right) {\n  vec2 step = vec2(1.0, 0.0);\n\n  center = samplePosition(xy);\n  left = (edge < -0.5) ? center : samplePosition(xy - step);\n  right = (edge > 0.5) ? center : samplePosition(xy + step);\n}\n\nvec3 getLineJoin(float edge, vec3 left, vec3 center, vec3 right) {\n  vec3 bitangent;\n  vec3 normal = center;\n\n  vec3 legLeft = center - left;\n  vec3 legRight = right - center;\n\n  if (edge > 0.5) {\n    bitangent = normalize(cross(normal, legLeft));\n  }\n  else if (edge < -0.5) {\n    bitangent = normalize(cross(normal, legRight));\n  }\n  else {\n    vec3 joinLeft = normalize(cross(normal, legLeft));\n    vec3 joinRight = normalize(cross(normal, legRight));\n    float dotLR = dot(joinLeft, joinRight);\n    float scale = min(8.0, tan(acos(dotLR * .999) * .5) * .5);\n    bitangent = normalize(joinLeft + joinRight) * sqrt(1.0 + scale * scale);\n  }\n  \n  return bitangent;\n}\n\nuniform float lineWidth;\nattribute vec2 line;\n//attribute vec3 position;\n\nvec3 getLinePosition() {\n  vec3 left, center, right, join;\n\n  float edge = line.x;\n  float offset = line.y;\n\n  getLineGeometry(position.xy, edge, left, center, right);\n  join = getLineJoin(edge, left, center, right);\n  return center + join * offset * lineWidth;\n}\n\n////\n\nvoid projectPosition(vec3 point) {\n	vec4 glPosition = projectionMatrix * vec4(point, 1.0);\n  gl_Position = glPosition;\n}\n\nvoid main() {\n  vec3 position = getLinePosition();\n  projectPosition(position);\n}",o="uniform vec3 lineColor;\nuniform float lineOpacity;\n\nvoid main() {\n	gl_FragColor = vec4(lineColor, lineOpacity);\n}",r=t("../renderable"),i=t("../geometry").LineGeometry,n=function(t){function e(t,n,r){var o,s,u,a,c,l;
e.__super__.constructor.call(this,t,n),a=null!=(l=r.uniforms)?l:{},u=r.position,this.geometry=new i({samples:r.samples||2,strips:r.strips||1,ribbons:r.ribbons||1}),s=n.material(),c=s.vertex,u&&c["import"](u),c.call("line.position",a),c.call("project.position"),o=s.fragment,o.call("line.color",a),this.material=new THREE.ShaderMaterial(s.build({side:THREE.DoubleSide,defaultAttributeValues:null})),window.material=this.material,this.object=new THREE.Mesh(this.geometry,this.material),this.object.frustumCulled=!1}return a(e,t),e.prototype.dispose=function(){return this.geometry.dispose(),this.material.dispose(),this.object=this.geometry=this.material=null,e.__super__.dispose.apply(this,arguments)},e}(r),e.exports=n},{"../geometry":28,"../renderable":33}],33:[function(t,e){var n;n=function(){function t(t,e){this.gl=t,this.shaders=e,null==this.uniforms&&(this.uniforms={})}return t.prototype.dispose=function(){return this.uniforms=null},t.prototype._adopt=function(t){var e,n;for(e in t)n=t[e],this.uniforms[e]=n},t.prototype._set=function(t){var e,n;for(e in t)n=t[e],null!=this.uniforms[e]&&(this.uniforms[e].value=n)},t}(),e.exports=n},{}],34:[function(t,e){var n,i={}.hasOwnProperty,r=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=function(){function t(t){var e;this.scene=t,e=function(t){function e(){THREE.Object3D.apply(this)}return r(e,t),e}(THREE.Object3D),this.root=new e}return t.prototype.getRoot=function(){return this.root},t.prototype.inject=function(){return this.scene.add(this.root)},t.prototype.unject=function(){return this.scene.remove(this.root)},t.prototype.add=function(t){return this.root.add(t)},t.prototype.remove=function(t){return this.root.remove(t)},t}(),e.exports=n},{}],35:[function(t,e,n){var i;i={line:t("./meshes").Line,databuffer:t("./buffer").DataBuffer,linebuffer:t("./buffer").LineBuffer,surfacebuffer:t("./buffer").SurfaceBuffer},n.Classes=i},{"./buffer":22,"./meshes":31}],36:[function(t,e){var n;n=function(t){return new ShaderGraph(t)},e.exports=n},{}],37:[function(t,e,n){n.Factory=t("./factory"),n.Snippets=MathBox.Shaders},{"./factory":36}],38:[function(t,e){var n;n=function(){function t(t){this.model=t}return t.prototype.update=function(){},t}(),e.exports=n},{}],39:[function(t,e){var n;n=function(){function t(t,e,n,i,r){var o,s,u,a;for(this._controller=t,this._animator=e,this._director=n,this._up=i,this._target=r,a=this._controller.getTypes(),s=0,u=a.length;u>s;s++)o=a[s],"root"!==o&&"group"!==o&&!function(t){return function(e){return t[e]=function(n){return t.add(e,n)}}}(this)(o);this._model=this._controller.model}return t.prototype.add=function(t,e){var n,i,r,o;return n=this._controller.make(t,e),r=null!=(o=this.target)?o:this._controller.getRoot(),n.children||r!==this._controller.getRoot()||(r=function(){var t,e,n,o;for(n=r.children,o=[],t=0,e=n.length;e>t;t++)i=n[t],null!=i.children&&o.push(i);return o}()[0]||r),this._controller.add(n,r),n.children?this.push(n):this},t.prototype.push=function(e){return new t(this._controller,this._animator,this._director,this,e)},t.prototype.end=function(){var t;return null!=(t=this._up)?t:this},t.prototype.reset=function(){return push({target:void 0})},t}(),e.exports=n},{}],40:[function(t,e){var n;n=function(){function t(t,e,n){this.model=t,this.scene=e,this.factory=n,this.render=function(t){return function(e){return t.scene.add(e.renderable.object)}}(this),this.unrender=function(t){return function(e){return t.scene.remove(e.renderable.object)}}(this)}return t.prototype.getRoot=function(){return this.model.getRoot()},t.prototype.getTypes=function(){return this.factory.getTypes()},t.prototype.make=function(t,e){return this.factory.make(t,e)},t.prototype.add=function(t,e){return null==e&&(e=this.model.getRoot()),t.primitive.on("render",this.render),t.primitive.on("unrender",this.unrender),e.add(t)},t.prototype.remove=function(t){var e;return e=t.parent||this.model.getRoot(),e.remove(t),t.primitive.off("render",this.render),t.primitive.off("unrender",this.unrender)},t}(),e.exports=n},{}],41:[function(t,e){var n;n=function(){function t(t,e){this.model=t,this.script=e}return t}(),e.exports=n},{}],42:[function(t,e,n){n.Animator=t("./animator"),n.API=t("./api"),n.Controller=t("./controller"),n.Director=t("./director")},{"./animator":38,"./api":39,"./controller":40,"./director":41}],43:[function(t,e,n){n.Ticks=t("./ticks")},{"./ticks":44}],44:[function(t,e,n){var i,r,o;i=function(t,e,n,i,r,o,s){var u,a,c,l,h,p,f,d,v,m,y,g,_,b;for(n||(n=10),s||(s=0),d=e-t,p=d/n,i||(i=1),r||(r=10),f=i*(s+Math.pow(r,Math.floor(Math.log(p/i)/Math.log(r)))),l=r%2===0?[r/2,1,.5]:r%3===0?[r/3,1,1/3]:[1],y=0,_=l.length;_>y;y++)c=l[y],m=f*c;for(u=1/0,v=m.reduce(function(t,e){var n;return n=Math.abs(e-p),u>n?(u=n,e):t},f),a=+!o,t=(Math.ceil(t/v)+a)*v,e=(Math.floor(e/v)-a)*v,n=Math.ceil((e-t)/v),b=[],h=g=0;n>=0?n>=g:g>=n;h=n>=0?++g:--g)b.push(t+x*v);return b},r=function(){throw"Log ticks not yet implemented."},o=function(t,e,n,i,r,o,s,u){switch(scale){case"linear":return Ticks.linear(e,n,i,r,o,s,u);case"log":return Ticks.log(e,n,i,r,o,s,u)}},n.make=o,n.linear=i,n.log=r},{}]},{},[3]);